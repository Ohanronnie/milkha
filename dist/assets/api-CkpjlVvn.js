const u="https://app.melka.ae/api",$=()=>localStorage.getItem("access_token"),P=()=>localStorage.getItem("refresh_token"),S=e=>localStorage.setItem("access_token",e),p=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("verify_email")};async function E(){const e=P();if(!e)throw new Error("No refresh token available");const t=await fetch(`${u}/auth/token/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:e})}),s=await t.json();if(!t.ok)throw console.error(" Token refresh failed:",s),p(),new Error(s.detail||"Failed to refresh token");return S(s.access),s.access}const m=async(e,t,s=null,r=!1,a=!0)=>{let i=$();const c=t.startsWith("/auth/");if(!i&&!c)throw p(),window.location.href="/login",new Error("No authentication token found");const l={...r?{}:{"Content-Type":"application/json"},...i&&!c&&{Authorization:`Bearer ${i}`}};try{const h=await fetch(`${u}${t}`,{method:e,headers:l,body:r?s:s?JSON.stringify(s):null});if(h.status===401&&!c&&a)try{const g=await E();if(g){const k={...l,Authorization:`Bearer ${g}`},y=await fetch(`${u}${t}`,{method:e,headers:k,body:r?s:s?JSON.stringify(s):null});return await w(y)}}catch(g){throw console.error("Failed to refresh token:",g),p(),window.location.href="/login",new Error("Session expired. Please login again.")}return await w(h)}catch(h){throw console.error("Request failed:",h),h}};async function w(e){const t=e.headers.get("content-type");let s;try{s=t!=null&&t.includes("application/json")?await e.json():await e.text()}catch(r){throw console.error("Failed to parse response:",r),new Error("Failed to parse server response")}if(!e.ok){if(e.status===401&&(s==null?void 0:s.code)==="token_not_valid")throw p(),window.location.href="/login",new Error("Session expired. Please login again.");const r=T(s,e.status,e.statusText),a=new Error(r);throw a.response=e,a.data=s,a}return s}function T(e,t,s){var r,a,i,c,l;return e?((r=e==null?void 0:e.non_field_errors)==null?void 0:r[0])||((a=e==null?void 0:e.email)==null?void 0:a[0])||((i=e==null?void 0:e.code)==null?void 0:i[0])||((c=e==null?void 0:e.password1)==null?void 0:c[0])||((l=e==null?void 0:e.password2)==null?void 0:l[0])||(e==null?void 0:e.detail)||(e==null?void 0:e.message)||`Request failed with status ${t} (${s})`:`Request failed with status ${t} (${s})`}const o=e=>m("GET",e),n=(e,t,s=!1)=>m("POST",e,t,s),f=(e,t)=>m("PATCH",e,t),d=e=>m("DELETE",e),v=(e,t)=>n("/auth/login/",{email:e,password:t}),R=e=>f("/auth/change-password/",e),I=(e,t)=>n("/auth/verify-email/",{email:e,code:t}),_=e=>n("/auth/resend-verification/",{email:e});async function B(e){const t=new FormData;return t.append("image",e),await n("/profile/photos/upload/",t,!0)}const U=()=>o("/admin/dashboard/stats/"),A=()=>o("/admin/dashboard/popular-profiles/"),j=()=>o("/admin/dashboard/top-locations/"),N=()=>o("/admin/dashboard/user-growth/"),b=()=>o("/admin/reports/"),q=e=>o(`/admin/reports/${e}/`),x=(e,t)=>f(`/admin/reports/${e}/`,t),C=e=>d(`/admin/reports/${e}/`),D=()=>o("/admin/users/"),F=e=>o(`/admin/users/${e}/`),L=(e,t)=>f(`/admin/users/${e}/`,t),M=()=>o("/profile/"),O=e=>n("/profile/create/",e),z=e=>f("/profile/update/",e),G=e=>d(`/profile/photos/delete/${e}/`),H=e=>f("/match-preferences/",e),J=e=>n(`/matchmaking/like/${e}/`),V=e=>n(`/matchmaking/shortlist/${e}/`),W=()=>o("/matchmaking/shortlisted/"),K=()=>o("/matchmaking/user/profile-status/"),Q=()=>o("/matchmaking/user/activity-feed/"),X=()=>o("/matchmaking/matches/today/"),Y=()=>o("/matchmaking/potential/"),Z=(e,t)=>n("/matchmaking/chat/send-message/",{receiverId:e,message:t}),ee=()=>o("/matchmaking/chat-rooms/"),te=()=>n("/notifications/mark-read/");export{b as A,D as B,F as C,x as D,q as E,L as F,C as G,d as H,R as I,v as a,H as b,O as c,ee as d,W as e,M as f,X as g,Z as h,Q as i,K as j,o as k,Y as l,V as m,z as n,G as o,n as p,te as q,_ as r,J as s,f as t,B as u,I as v,U as w,A as x,j as y,N as z};

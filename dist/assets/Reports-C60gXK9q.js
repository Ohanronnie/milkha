import{u as L,r as l,j as e}from"./index-BonXIjnK.js";import{A as I}from"./aos-qFhLIK5-.js";import{F as u}from"./index.es-BS6_hyzh.js";import{A as $,T as O,l as U}from"./index-CokvSRJh.js";import{y as d}from"./index-BPRxkVGZ.js";import{A as B,G as M,D as V}from"./api-CkpjlVvn.js";const D={PENDING:"bg-yellow-100 text-yellow-700","UNDER REVIEW":"bg-orange-100 text-orange-700",RESOLVED:"bg-green-100 text-green-700",ACTIVE:"bg-emerald-100 text-emerald-700",SUSPENDED:"bg-red-100 text-red-700"},z=["PENDING","UNDER REVIEW","RESOLVED"],Z=()=>{var N,f,v,w;const x=L(),[k,m]=l.useState([]),[R,G]=l.useState(""),[g,W]=l.useState("ALL"),[y,Y]=l.useState("ALL"),[T,C]=l.useState(null),[n,p]=l.useState(1),[t,i]=l.useState(null),h=8;l.useEffect(()=>{if(I.init({duration:800,once:!0}),!localStorage.getItem("milkha_token")){x("/login");return}(async()=>{try{const a=await B();m(a||[])}catch(a){console.error("Failed to fetch reports:",a.message),d.error("Error loading reports")}})()},[x]);const F=async(s,r)=>{try{await V(s,{status:r}),m(a=>a.map(o=>o.id===s?{...o,status:r}:o)),(t==null?void 0:t.id)===s&&i({...t,status:r}),d.success("Status updated")}catch(a){console.error("Failed to update report status:",a.message),d.error("Failed to update status")}},P=async s=>{try{await M(s),m(r=>r.filter(a=>a.id!==s)),i(null),d.success("Report deleted")}catch(r){console.error("Failed to delete report:",r.message),d.error("Failed to delete report")}},j=k.filter(s=>{var E,S;const r=g==="ALL"||s.status===g,a=y==="ALL"||s.issue===y,A=`
      ${((E=s.reported_user)==null?void 0:E.name)||""}
      ${((S=s.reported_by)==null?void 0:S.name)||""}
      ${s.issue||""}
      ${s.status||""}
      ${s.date||""}
    `.toLowerCase().includes(R.toLowerCase());return r&&a&&A}),c=Math.ceil(j.length/h),_=j.slice((n-1)*h,n*h),b=s=>x(`/profile/${s}`);return e.jsxs("div",{className:"relative bg-[#FDFDFD] z-50",children:[e.jsxs("div",{className:"p-6 transition-all duration-300",children:[e.jsx("h2",{className:"text-2xl hover:text-purple-600 hover:scale-105 transition font-bold text-gray-800 mb-4",children:"Report Management"}),e.jsx("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:e.jsxs("table",{className:"min-w-full text-sm text-gray-600",children:[e.jsx("thead",{className:"bg-gray-50 text-xs text-gray-500 uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Reported User"}),e.jsx("th",{className:"px-6 py-3",children:"Reported By"}),e.jsx("th",{className:"px-6 py-3",children:"Report Type"}),e.jsx("th",{className:"px-6 py-3",children:"Status"}),e.jsx("th",{className:"px-6 py-3",children:"Date"}),e.jsx("th",{className:"px-6 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:_.map(s=>{var r,a;return e.jsxs("tr",{className:"border-t hover:bg-gray-50 transition duration-300 cursor-pointer",onClick:()=>i(s),children:[e.jsx("td",{className:"px-6 py-4",children:((r=s.reported_user)==null?void 0:r.name)||"N/A"}),e.jsx("td",{className:"px-6 py-4",children:((a=s.reported_by)==null?void 0:a.name)||"N/A"}),e.jsx("td",{className:"px-6 py-4",children:s.issue}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`text-xs px-3 py-1 rounded-full ${D[s.status]}`,children:s.status})}),e.jsx("td",{className:"px-6 py-4",children:s.date}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx(u,{icon:$,className:"text-red-500 hover:text-red-700",onClick:o=>{o.stopPropagation(),P(s.id)}})})]},s.id)})})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center px-4 py-4 text-sm text-gray-600 gap-3",children:[e.jsxs("span",{children:["Page ",n," of ",c]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-3 py-1 border rounded",disabled:n===1,onClick:()=>p(s=>Math.max(s-1,1)),children:"← Prev"}),[...Array(c)].map((s,r)=>{const a=r+1;return e.jsx("button",{onClick:()=>p(a),className:`px-3 py-1 border rounded ${n===a?"bg-purple-600 text-white":""}`,children:a},a)}),e.jsx("button",{className:"px-3 py-1 border rounded",disabled:n===c,onClick:()=>p(s=>Math.min(s+1,c)),children:"Next →"})]})]})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{"data-aos":"slide-left",className:"fixed inset-0 bg-black/30 backdrop-blur-sm z-40",onClick:()=>i(null)}),e.jsx("div",{"data-aos":"slide-left",className:"fixed top-0 right-0 w-full sm:max-w-md h-full bg-[#FAFCFE] z-50 shadow-lg transition-transform transform translate-x-0 duration-500 overflow-y-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("button",{onClick:()=>i(null),className:"text-sm text-gray-500 flex items-center gap-1 hover:underline",children:[e.jsx(u,{icon:O,className:"text-gray-600 border border-gray-300 rounded border-md px-2 py-1 bg-white"}),"Back to Reports"]}),e.jsxs("div",{className:"flex justify-between items-start relative",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Report ID: #",t.id]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${D[t.status]}`,children:t.status})]}),e.jsxs("div",{className:"relative",children:[e.jsx(u,{icon:U,className:"cursor-pointer px-2 py-1 text-gray-500 hover:text-gray-700 border rounded-md border-gray-300 bg-white",onClick:()=>C(s=>s==="panel-status"?null:"panel-status")}),T==="panel-status"&&e.jsx("div",{className:"absolute right-0 mt-2 w-40 bg-white border rounded-md shadow z-50",children:z.map(s=>e.jsx("div",{className:`px-4 py-2 text-sm cursor-pointer hover:bg-gray-100 ${t.status===s?"bg-purple-100 font-medium":""}`,onClick:()=>F(t.id,s),children:s},s))})]})]}),e.jsx("hr",{className:"my-4 border-t border-gray-300"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"REPORTED USER"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:((N=t==null?void 0:t.reported_user)==null?void 0:N.profile_image)||"/images/avatar.png",className:"w-8 h-8 rounded-full object-cover"}),e.jsx("button",{onClick:()=>{var s;return((s=t==null?void 0:t.reported_user)==null?void 0:s.id)&&b(t.reported_user.id)},className:"text-sm text-black hover:underline",children:((f=t==null?void 0:t.reported_user)==null?void 0:f.name)||"Unknown"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"REPORTED BY"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:((v=t==null?void 0:t.reported_by)==null?void 0:v.profile_image)||"/images/icon.png",className:"w-8 h-8 rounded-full object-cover"}),e.jsx("button",{onClick:()=>{var s;return((s=t==null?void 0:t.reported_by)==null?void 0:s.id)&&b(t.reported_by.id)},className:"text-sm text-black hover:underline",children:((w=t==null?void 0:t.reported_by)==null?void 0:w.name)||"Unknown"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"DATE SUBMITTED"}),e.jsx("p",{className:"text-sm",children:t.date})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"REPORT TYPE"}),e.jsx("span",{className:"text-xs px-3 py-1 bg-gray-100 rounded-full",children:t.issue})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"REPORT DESCRIPTION"}),e.jsx("div",{className:"text-sm text-gray-700",dangerouslySetInnerHTML:{__html:t.description}})]})]})})]})]})};export{Z as default};
